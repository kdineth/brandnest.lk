<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brandnest.lk - CRM Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1e2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: #2a2e3a;
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffffff;
        }

        .header span {
            color: #718bab;
        }

        .theme-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(113, 139, 171, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(113, 139, 171, 0.5);
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: #718bab;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .theme-toggle.active {
            background: rgba(113, 139, 171, 0.6);
        }

        .theme-toggle.active::before {
            transform: translateX(30px);
            background: #ffffff;
        }

        .theme-label {
            font-size: 0.9rem;
            color: #b0b8c8;
            font-weight: 500;
        }

        /* Light theme styles */
        body.light-theme {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #2d3748;
        }

        body.light-theme .header {
            background: #ffffff;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        body.light-theme .header h1 {
            color: #2a2e3a;
        }

        body.light-theme .nav-tab {
            background: rgba(113, 139, 171, 0.1);
            border: 1px solid rgba(113, 139, 171, 0.2);
            color: #4a5568;
        }

        body.light-theme .nav-tab:hover {
            background: rgba(113, 139, 171, 0.2);
        }

        body.light-theme .nav-tab.active {
            background: #718bab;
            color: #ffffff;
        }

        body.light-theme .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            border: 1px solid rgba(113, 139, 171, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            color: #2d3748;
        }

        body.light-theme .stat-card p {
            color: #4a5568;
        }

        body.light-theme .form-section {
            background: #ffffff;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            color: #2d3748;
        }

        body.light-theme .form-section h2 {
            color: #718bab;
        }

        body.light-theme .form-group label {
            color: #4a5568;
        }

        body.light-theme .form-group input,
        body.light-theme .form-group select,
        body.light-theme .form-group textarea {
            background: #f7fafc;
            border: 1px solid rgba(113, 139, 171, 0.3);
            color: #2d3748;
        }

        body.light-theme .form-group input:focus,
        body.light-theme .form-group select:focus,
        body.light-theme .form-group textarea:focus {
            background: #ffffff;
            border-color: #718bab;
            box-shadow: 0 0 0 3px rgba(113, 139, 171, 0.2);
        }

        body.light-theme .data-table {
            background: #ffffff;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        body.light-theme .table-header {
            background: linear-gradient(135deg, #f7fafc 0%, #ffffff 100%);
        }

        body.light-theme .table-header h3 {
            color: #718bab;
        }

        body.light-theme .search-box {
            background: #f7fafc;
            border: 1px solid rgba(113, 139, 171, 0.3);
            color: #2d3748;
        }

        body.light-theme th {
            background: rgba(113, 139, 171, 0.1);
            color: #4a5568;
        }

        body.light-theme th:hover {
            background: rgba(113, 139, 171, 0.2);
        }

        body.light-theme tr:hover {
            background: rgba(113, 139, 171, 0.05);
        }

        body.light-theme td {
            color: #2d3748;
            border-bottom: 1px solid rgba(113, 139, 171, 0.1);
        }

        body.light-theme .chart-container {
            background: #ffffff;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            color: #2d3748;
        }

        body.light-theme .chart-placeholder {
            background: rgba(113, 139, 171, 0.05);
            border: 2px dashed rgba(113, 139, 171, 0.3);
            color: #718bab;
        }

        body.light-theme .modal {
            background-color: rgba(0,0,0,0.5);
        }

        body.light-theme .modal-content {
            background: #ffffff;
            color: #2d3748;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        body.light-theme .close {
            color: #718bab;
        }

        body.light-theme .close:hover {
            color: #2d3748;
        }

        body.light-theme .theme-label {
            color: #4a5568;
        }

        body.light-theme .theme-toggle {
            background: rgba(113, 139, 171, 0.2);
            border: 1px solid rgba(113, 139, 171, 0.3);
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: rgba(113, 139, 171, 0.1);
            border: 1px solid rgba(113, 139, 171, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: rgba(113, 139, 171, 0.2);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: #718bab;
            color: #2a2e3a;
            box-shadow: 0 4px 15px rgba(113, 139, 171, 0.4);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #2a2e3a 0%, #3a4052 100%);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(113, 139, 171, 0.2);
        }

        .stat-card i {
            font-size: 2.5rem;
            color: #718bab;
            margin-bottom: 1rem;
        }

        .stat-card h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: #b0b8c8;
            font-weight: 500;
        }

        .form-section {
            background: #2a2e3a;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .form-section h2 {
            margin-bottom: 1.5rem;
            color: #718bab;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #b0b8c8;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid rgba(113, 139, 171, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #718bab;
            box-shadow: 0 0 0 3px rgba(113, 139, 171, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #718bab 0%, #5a7a9a 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(113, 139, 171, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .data-table {
            background: #2a2e3a;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .table-header {
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, #3a4052 0%, #2a2e3a 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-header h3 {
            color: #718bab;
            font-weight: 600;
        }

        .search-box {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(113, 139, 171, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-family: inherit;
            min-width: 250px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(113, 139, 171, 0.1);
        }

        th {
            background: rgba(113, 139, 171, 0.1);
            font-weight: 600;
            color: #718bab;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: rgba(113, 139, 171, 0.2);
        }

        tr:hover {
            background: rgba(113, 139, 171, 0.05);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-lead {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid #3498db;
        }

        .status-active {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid #2ecc71;
        }

        .status-inactive {
            background: rgba(149, 165, 166, 0.2);
            color: #95a5a6;
            border: 1px solid #95a5a6;
        }

        .action-btn {
            padding: 0.25rem 0.5rem;
            margin: 0 0.25rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .edit-btn {
            background: #f39c12;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #2a2e3a;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #718bab;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ffffff;
        }

        .chart-container {
            background: #2a2e3a;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .chart-placeholder {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(113, 139, 171, 0.1);
            border-radius: 8px;
            border: 2px dashed rgba(113, 139, 171, 0.3);
            color: #718bab;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .theme-switcher {
                order: -1;
                align-self: flex-end;
            }

            .nav-tabs {
                gap: 0.25rem;
                order: 1;
                width: 100%;
            }

            .nav-tab {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stat-card {
                padding: 1.5rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: 100%;
            }

            th, td {
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Brand<span>nest.lk</span></h1>
        <div class="theme-switcher">
            <span class="theme-label">Dark</span>
            <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()"></div>
            <span class="theme-label">Light</span>
        </div>
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('dashboard')">
                <i class="fas fa-chart-dashboard"></i> Dashboard
            </div>
            <div class="nav-tab" onclick="showTab('clients')">
                <i class="fas fa-users"></i> Clients
            </div>
            <div class="nav-tab" onclick="showTab('payments')">
                <i class="fas fa-credit-card"></i> Payments
            </div>
            <div class="nav-tab" onclick="showTab('expenses')">
                <i class="fas fa-receipt"></i> Expenses
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="form-section" style="margin-bottom: 1rem;">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                    <button onclick="loadDataFromSheets()" class="btn btn-primary">
                        <i class="fas fa-download"></i> Load from Google Sheets
                    </button>
                    <button onclick="saveDataToSheets()" class="btn btn-primary">
                        <i class="fas fa-upload"></i> Save to Google Sheets
                    </button>
                    <div style="color: #b0b8c8; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> 
                        Last sync: <span id="lastSyncTime">Never</span>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="totalClients">0</h3>
                    <p>Total Clients</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-dollar-sign"></i>
                    <h3 id="totalRevenue">Rs. 0</h3>
                    <p>Total Revenue</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-credit-card"></i>
                    <h3 id="totalExpenses">Rs. 0</h3>
                    <p>Total Expenses</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-chart-line"></i>
                    <h3 id="netProfit">Rs. 0</h3>
                    <p>Net Profit</p>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="color: #718bab; margin-bottom: 1rem;">Revenue vs Expenses</h3>
                <div class="chart-placeholder">
                    <i class="fas fa-chart-bar" style="margin-right: 1rem; font-size: 2rem;"></i>
                    Chart visualization will appear here
                </div>
            </div>
        </div>

        <!-- Clients Tab -->
        <div id="clients" class="tab-content">
            <div class="form-section">
                <h2><i class="fas fa-user-plus"></i> Add New Client</h2>
                <form id="clientForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="clientName">Client Name *</label>
                            <input type="text" id="clientName" required>
                        </div>
                        <div class="form-group">
                            <label for="clientCompany">Company</label>
                            <input type="text" id="clientCompany">
                        </div>
                        <div class="form-group">
                            <label for="clientEmail">Email</label>
                            <input type="email" id="clientEmail">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Phone</label>
                            <input type="tel" id="clientPhone">
                        </div>
                        <div class="form-group">
                            <label for="clientStatus">Status</label>
                            <select id="clientStatus">
                                <option value="Lead">Lead</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clientNotes">Notes</label>
                        <textarea id="clientNotes" rows="3" placeholder="Additional notes about the client..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Client
                    </button>
                </form>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-users"></i> Client List</h3>
                    <input type="text" class="search-box" id="clientSearch" placeholder="Search clients...">
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortTable('clients', 0)">Name <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('clients', 1)">Company <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('clients', 2)">Email <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('clients', 3)">Phone <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('clients', 4)">Status <i class="fas fa-sort"></i></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Payments Tab -->
        <div id="payments" class="tab-content">
            <div class="form-section">
                <h2><i class="fas fa-plus-circle"></i> Add Payment</h2>
                <form id="paymentForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="paymentClient">Client *</label>
                            <select id="paymentClient" required>
                                <option value="">Select Client</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentAmount">Amount (Rs.) *</label>
                            <input type="number" id="paymentAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentDate">Payment Date *</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">Payment Method</label>
                            <select id="paymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="Bank">Bank Transfer</option>
                                <option value="Card">Card</option>
                                <option value="Online">Online Transfer</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="paymentNotes">Notes/Description</label>
                        <textarea id="paymentNotes" rows="3" placeholder="Payment description..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Payment
                    </button>
                </form>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-credit-card"></i> Payment History</h3>
                    <input type="text" class="search-box" id="paymentSearch" placeholder="Search payments...">
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortTable('payments', 0)">Client <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('payments', 1)">Amount <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('payments', 2)">Date <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('payments', 3)">Method <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('payments', 4)">Notes <i class="fas fa-sort"></i></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expenses" class="tab-content">
            <div class="form-section">
                <h2><i class="fas fa-plus-circle"></i> Add Expense</h2>
                <form id="expenseForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="expenseTitle">Expense Title *</label>
                            <input type="text" id="expenseTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="expenseAmount">Amount (Rs.) *</label>
                            <input type="number" id="expenseAmount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="expenseCategory">Category</label>
                            <select id="expenseCategory">
                                <option value="Marketing">Marketing</option>
                                <option value="Tools">Tools & Software</option>
                                <option value="Salaries">Salaries</option>
                                <option value="Office">Office Expenses</option>
                                <option value="Travel">Travel</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="expenseDate">Expense Date *</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="expenseDescription">Description</label>
                        <textarea id="expenseDescription" rows="3" placeholder="Expense description..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </form>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-receipt"></i> Expense History</h3>
                    <input type="text" class="search-box" id="expenseSearch" placeholder="Search expenses...">
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortTable('expenses', 0)">Title <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('expenses', 1)">Amount <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('expenses', 2)">Category <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('expenses', 3)">Date <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable('expenses', 4)">Description <i class="fas fa-sort"></i></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2 id="editModalTitle">Edit Item</h2>
            <div id="editModalContent"></div>
        </div>
    </div>

    <script>
        // Data storage and Google Sheets integration
        let appData = {
            clients: [],
            payments: [],
            expenses: [],
            theme: 'dark'
        };

        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            apiKey: 'AIzaSyBXTQeqzDFHS1e6bO5wYODPekkRAdps0S4', // Your API key
            spreadsheetId: '168aL1CX0spykmfQCewqY-yxYUH0PSqCWPsCEZg7byQQ', // Your spreadsheet ID
            sheets: {
                clients: 'Clients!A:G',
                payments: 'Payments!A:G', 
                expenses: 'Expenses!A:F'
            }
        };

        // Google Sheets API functions
        async function loadDataFromSheets() {
            try {
                showNotification('Loading data from Google Sheets...', 'info');
                
                // Load clients
                const clientsData = await fetchSheetData('clients');
                if (clientsData && clientsData.length > 1) {
                    appData.clients = parseClientsFromSheet(clientsData.slice(1)); // Skip header row
                }

                // Load payments  
                const paymentsData = await fetchSheetData('payments');
                if (paymentsData && paymentsData.length > 1) {
                    appData.payments = parsePaymentsFromSheet(paymentsData.slice(1));
                }

                // Load expenses
                const expensesData = await fetchSheetData('expenses');
                if (expensesData && expensesData.length > 1) {
                    appData.expenses = parseExpensesFromSheet(expensesData.slice(1));
                }

                // Refresh UI
                renderClientsTable();
                renderPaymentsTable();
                renderExpensesTable();
                updateDashboard();
                updatePaymentClientOptions();
                
                showNotification('Data loaded successfully!', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Failed to load data from Google Sheets', 'error');
            }
        }

        async function fetchSheetData(sheetType) {
            const range = GOOGLE_SHEETS_CONFIG.sheets[sheetType];
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${range}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
            
            console.log('Fetching from URL:', url); // Debug log
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                console.log('Response status:', response.status); // Debug log
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Fetched data for', sheetType, ':', data); // Debug log
                return data.values;
            } catch (error) {
                console.error('Fetch error for', sheetType, ':', error);
                throw error;
            }
        }

        async function saveDataToSheets() {
            try {
                showNotification('Saving data to Google Sheets...', 'info');
                
                // Save clients
                await saveSheetData('clients', formatClientsForSheet());
                
                // Save payments
                await saveSheetData('payments', formatPaymentsForSheet());
                
                // Save expenses
                await saveSheetData('expenses', formatExpensesForSheet());
                
                showNotification('Data saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Failed to save data to Google Sheets', 'error');
            }
        }

        async function saveSheetData(sheetType, data) {
            const range = GOOGLE_SHEETS_CONFIG.sheets[sheetType];
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${range}?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    values: data
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
        }

        // Data formatting functions
        function formatClientsForSheet() {
            const header = ['ID', 'Name', 'Company', 'Email', 'Phone', 'Status', 'Notes'];
            const rows = appData.clients.map(client => [
                client.id,
                client.name,
                client.company || '',
                client.email || '',
                client.phone || '',
                client.status,
                client.notes || ''
            ]);
            return [header, ...rows];
        }

        function formatPaymentsForSheet() {
            const header = ['ID', 'Client ID', 'Client Name', 'Amount', 'Date', 'Method', 'Notes'];
            const rows = appData.payments.map(payment => [
                payment.id,
                payment.clientId,
                payment.clientName,
                payment.amount,
                payment.date,
                payment.method,
                payment.notes || ''
            ]);
            return [header, ...rows];
        }

        function formatExpensesForSheet() {
            const header = ['ID', 'Title', 'Amount', 'Category', 'Date', 'Description'];
            const rows = appData.expenses.map(expense => [
                expense.id,
                expense.title,
                expense.amount,
                expense.category,
                expense.date,
                expense.description || ''
            ]);
            return [header, ...rows];
        }

        // Data parsing functions
        function parseClientsFromSheet(rows) {
            return rows.map(row => ({
                id: parseInt(row[0]) || Date.now(),
                name: row[1] || '',
                company: row[2] || '',
                email: row[3] || '',
                phone: row[4] || '',
                status: row[5] || 'Lead',
                notes: row[6] || ''
            })).filter(client => client.name); // Filter out empty rows
        }

        function parsePaymentsFromSheet(rows) {
            return rows.map(row => ({
                id: parseInt(row[0]) || Date.now(),
                clientId: parseInt(row[1]) || 0,
                clientName: row[2] || '',
                amount: parseFloat(row[3]) || 0,
                date: row[4] || '',
                method: row[5] || 'Cash',
                notes: row[6] || ''
            })).filter(payment => payment.clientName); // Filter out empty rows
        }

        function parseExpensesFromSheet(rows) {
            return rows.map(row => ({
                id: parseInt(row[0]) || Date.now(),
                title: row[1] || '',
                amount: parseFloat(row[2]) || 0,
                category: row[3] || 'Other',
                date: row[4] || '',
                description: row[5] || ''
            })).filter(expense => expense.title); // Filter out empty rows
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').value = today;
            document.getElementById('expenseDate').value = today;

            // Initialize theme
            initializeTheme();
            
            // Render all tables and update dashboard (will be empty initially)
            renderClientsTable();
            renderPaymentsTable();
            renderExpensesTable();
            updateDashboard();
            updatePaymentClientOptions();

            // Add event listeners
            setupEventListeners();

            // Auto-load data from Google Sheets on startup
            loadDataFromSheets();
        });

        function initializeTheme() {
            const savedTheme = appData.theme;
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                document.getElementById('themeToggle').classList.add('active');
            }
        }

        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            if (body.classList.contains('light-theme')) {
                // Switch to dark theme
                body.classList.remove('light-theme');
                themeToggle.classList.remove('active');
                appData.theme = 'dark';
                showNotification('Switched to Dark Mode', 'success');
            } else {
                // Switch to light theme
                body.classList.add('light-theme');
                themeToggle.classList.add('active');
                appData.theme = 'light';
                showNotification('Switched to Light Mode', 'success');
            }
        }

        function setupEventListeners() {
            document.getElementById('clientForm').addEventListener('submit', handleClientSubmit);
            document.getElementById('paymentForm').addEventListener('submit', handlePaymentSubmit);
            document.getElementById('expenseForm').addEventListener('submit', handleExpenseSubmit);

            document.getElementById('clientSearch').addEventListener('input', () => filterTable('clients'));
            document.getElementById('paymentSearch').addEventListener('input', () => filterTable('payments'));
            document.getElementById('expenseSearch').addEventListener('input', () => filterTable('expenses'));
        }

        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked nav tab
            event.target.closest('.nav-tab').classList.add('active');
        }

        function handleClientSubmit(e) {
            e.preventDefault();
            
            const clientData = {
                id: Date.now(),
                name: document.getElementById('clientName').value,
                company: document.getElementById('clientCompany').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                status: document.getElementById('clientStatus').value,
                notes: document.getElementById('clientNotes').value
            };

            appData.clients.push(clientData);
            renderClientsTable();
            updateDashboard();
            updatePaymentClientOptions();
            document.getElementById('clientForm').reset();
            
            // Auto-save to Google Sheets
            autoSaveToSheets();
            
            showNotification('Client added successfully!', 'success');
        }

        function handlePaymentSubmit(e) {
            e.preventDefault();
            
            const clientId = parseInt(document.getElementById('paymentClient').value);
            const client = appData.clients.find(c => c.id === clientId);
            
            const paymentData = {
                id: Date.now(),
                clientId: clientId,
                clientName: client ? client.name : '',
                amount: parseFloat(document.getElementById('paymentAmount').value),
                date: document.getElementById('paymentDate').value,
                method: document.getElementById('paymentMethod').value,
                notes: document.getElementById('paymentNotes').value
            };

            appData.payments.push(paymentData);
            renderPaymentsTable();
            updateDashboard();
            document.getElementById('paymentForm').reset();
            
            // Reset date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').value = today;
            
            // Auto-save to Google Sheets
            autoSaveToSheets();
            
            showNotification('Payment added successfully!', 'success');
        }

        function handleExpenseSubmit(e) {
            e.preventDefault();
            
            const expenseData = {
                id: Date.now(),
                title: document.getElementById('expenseTitle').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                category: document.getElementById('expenseCategory').value,
                date: document.getElementById('expenseDate').value,
                description: document.getElementById('expenseDescription').value
            };

            appData.expenses.push(expenseData);
            renderExpensesTable();
            updateDashboard();
            document.getElementById('expenseForm').reset();
            
            // Reset date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expenseDate').value = today;
            
            // Auto-save to Google Sheets
            autoSaveToSheets();
            
            showNotification('Expense added successfully!', 'success');
        }

        // Auto-save function with debouncing
        let saveTimeout;
        function autoSaveToSheets() {
            // Clear existing timeout
            clearTimeout(saveTimeout);
            
            // Set new timeout for auto-save (debounced)
            saveTimeout = setTimeout(() => {
                saveDataToSheets();
                updateLastSyncTime();
            }, 2000); // Save 2 seconds after last change
        }

        function updateLastSyncTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastSyncTime').textContent = timeString;
        }

        function renderClientsTable() {
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';

            appData.clients.forEach(client => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.company || '-'}</td>
                    <td>${client.email || '-'}</td>
                    <td>${client.phone || '-'}</td>
                    <td><span class="status-badge status-${client.status.toLowerCase()}">${client.status}</span></td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editClient(${client.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteClient(${client.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderPaymentsTable() {
            const tbody = document.getElementById('paymentsTableBody');
            tbody.innerHTML = '';

            appData.payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.clientName}</td>
                    <td>Rs. ${payment.amount.toLocaleString()}</td>
                    <td>${formatDate(payment.date)}</td>
                    <td>${payment.method}</td>
                    <td>${payment.notes || '-'}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editPayment(${payment.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deletePayment(${payment.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderExpensesTable() {
            const tbody = document.getElementById('expensesTableBody');
            tbody.innerHTML = '';

            appData.expenses.forEach(expense => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${expense.title}</td>
                    <td>Rs. ${expense.amount.toLocaleString()}</td>
                    <td>${expense.category}</td>
                    <td>${formatDate(expense.date)}</td>
                    <td>${expense.description || '-'}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editExpense(${expense.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteExpense(${expense.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateDashboard() {
            // Update client stats
            const totalClients = appData.clients.length;
            const activeClients = appData.clients.filter(c => c.status === 'Active').length;
            const leadClients = appData.clients.filter(c => c.status === 'Lead').length;

            // Update revenue stats
            const totalRevenue = appData.payments.reduce((sum, payment) => sum + payment.amount, 0);
            
            // Update expense stats
            const totalExpenses = appData.expenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            // Calculate net profit
            const netProfit = totalRevenue - totalExpenses;

            // Update DOM elements
            document.getElementById('totalClients').textContent = totalClients;
            document.getElementById('totalRevenue').textContent = `Rs. ${totalRevenue.toLocaleString()}`;
            document.getElementById('totalExpenses').textContent = `Rs. ${totalExpenses.toLocaleString()}`;
            document.getElementById('netProfit').textContent = `Rs. ${netProfit.toLocaleString()}`;
            
            // Color code the net profit
            const profitElement = document.getElementById('netProfit');
            if (netProfit > 0) {
                profitElement.style.color = '#2ecc71';
            } else if (netProfit < 0) {
                profitElement.style.color = '#e74c3c';
            } else {
                profitElement.style.color = '#ffffff';
            }
        }

        function updatePaymentClientOptions() {
            const select = document.getElementById('paymentClient');
            select.innerHTML = '<option value="">Select Client</option>';
            
            appData.clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.name} ${client.company ? '(' + client.company + ')' : ''}`;
                select.appendChild(option);
            });
        }

        function deleteClient(id) {
            if (confirm('Are you sure you want to delete this client? This will also delete all related payments.')) {
                appData.clients = appData.clients.filter(client => client.id !== id);
                appData.payments = appData.payments.filter(payment => payment.clientId !== id);
                renderClientsTable();
                renderPaymentsTable();
                updateDashboard();
                updatePaymentClientOptions();
                showNotification('Client deleted successfully!', 'success');
            }
        }

        function deletePayment(id) {
            if (confirm('Are you sure you want to delete this payment?')) {
                appData.payments = appData.payments.filter(payment => payment.id !== id);
                renderPaymentsTable();
                updateDashboard();
                showNotification('Payment deleted successfully!', 'success');
            }
        }

        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense?')) {
                appData.expenses = appData.expenses.filter(expense => expense.id !== id);
                renderExpensesTable();
                updateDashboard();
                showNotification('Expense deleted successfully!', 'success');
            }
        }

        function editClient(id) {
            const client = appData.clients.find(c => c.id === id);
            if (!client) return;

            const modalContent = `
                <form id="editClientForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editClientName">Client Name *</label>
                            <input type="text" id="editClientName" value="${client.name}" required>
                        </div>
                        <div class="form-group">
                            <label for="editClientCompany">Company</label>
                            <input type="text" id="editClientCompany" value="${client.company || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editClientEmail">Email</label>
                            <input type="email" id="editClientEmail" value="${client.email || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editClientPhone">Phone</label>
                            <input type="tel" id="editClientPhone" value="${client.phone || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editClientStatus">Status</label>
                            <select id="editClientStatus">
                                <option value="Lead" ${client.status === 'Lead' ? 'selected' : ''}>Lead</option>
                                <option value="Active" ${client.status === 'Active' ? 'selected' : ''}>Active</option>
                                <option value="Inactive" ${client.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editClientNotes">Notes</label>
                        <textarea id="editClientNotes" rows="3">${client.notes || ''}</textarea>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Client
                        </button>
                        <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 1rem;">
                            Cancel
                        </button>
                    </div>
                </form>
            `;

            showEditModal('Edit Client', modalContent);

            document.getElementById('editClientForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const updatedClient = {
                    ...client,
                    name: document.getElementById('editClientName').value,
                    company: document.getElementById('editClientCompany').value,
                    email: document.getElementById('editClientEmail').value,
                    phone: document.getElementById('editClientPhone').value,
                    status: document.getElementById('editClientStatus').value,
                    notes: document.getElementById('editClientNotes').value
                };

                const index = appData.clients.findIndex(c => c.id === id);
                appData.clients[index] = updatedClient;
                
                // Update related payments with new client name
                appData.payments.forEach(payment => {
                    if (payment.clientId === id) {
                        payment.clientName = updatedClient.name;
                    }
                });

                renderClientsTable();
                renderPaymentsTable();
                updatePaymentClientOptions();
                closeEditModal();
                showNotification('Client updated successfully!', 'success');
            });
        }

        function editPayment(id) {
            const payment = appData.payments.find(p => p.id === id);
            if (!payment) return;

            let clientOptions = '';
            appData.clients.forEach(client => {
                const selected = client.id === payment.clientId ? 'selected' : '';
                clientOptions += `<option value="${client.id}" ${selected}>${client.name} ${client.company ? '(' + client.company + ')' : ''}</option>`;
            });

            const modalContent = `
                <form id="editPaymentForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editPaymentClient">Client *</label>
                            <select id="editPaymentClient" required>
                                ${clientOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editPaymentAmount">Amount (Rs.) *</label>
                            <input type="number" id="editPaymentAmount" step="0.01" value="${payment.amount}" required>
                        </div>
                        <div class="form-group">
                            <label for="editPaymentDate">Payment Date *</label>
                            <input type="date" id="editPaymentDate" value="${payment.date}" required>
                        </div>
                        <div class="form-group">
                            <label for="editPaymentMethod">Payment Method</label>
                            <select id="editPaymentMethod">
                                <option value="Cash" ${payment.method === 'Cash' ? 'selected' : ''}>Cash</option>
                                <option value="Bank" ${payment.method === 'Bank' ? 'selected' : ''}>Bank Transfer</option>
                                <option value="Card" ${payment.method === 'Card' ? 'selected' : ''}>Card</option>
                                <option value="Online" ${payment.method === 'Online' ? 'selected' : ''}>Online Transfer</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editPaymentNotes">Notes/Description</label>
                        <textarea id="editPaymentNotes" rows="3">${payment.notes || ''}</textarea>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Payment
                        </button>
                        <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 1rem;">
                            Cancel
                        </button>
                    </div>
                </form>
            `;

            showEditModal('Edit Payment', modalContent);

            document.getElementById('editPaymentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const clientId = parseInt(document.getElementById('editPaymentClient').value);
                const client = appData.clients.find(c => c.id === clientId);
                
                const updatedPayment = {
                    ...payment,
                    clientId: clientId,
                    clientName: client ? client.name : '',
                    amount: parseFloat(document.getElementById('editPaymentAmount').value),
                    date: document.getElementById('editPaymentDate').value,
                    method: document.getElementById('editPaymentMethod').value,
                    notes: document.getElementById('editPaymentNotes').value
                };

                const index = appData.payments.findIndex(p => p.id === id);
                appData.payments[index] = updatedPayment;

                renderPaymentsTable();
                updateDashboard();
                closeEditModal();
                showNotification('Payment updated successfully!', 'success');
            });
        }

        function editExpense(id) {
            const expense = appData.expenses.find(e => e.id === id);
            if (!expense) return;

            const modalContent = `
                <form id="editExpenseForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editExpenseTitle">Expense Title *</label>
                            <input type="text" id="editExpenseTitle" value="${expense.title}" required>
                        </div>
                        <div class="form-group">
                            <label for="editExpenseAmount">Amount (Rs.) *</label>
                            <input type="number" id="editExpenseAmount" step="0.01" value="${expense.amount}" required>
                        </div>
                        <div class="form-group">
                            <label for="editExpenseCategory">Category</label>
                            <select id="editExpenseCategory">
                                <option value="Marketing" ${expense.category === 'Marketing' ? 'selected' : ''}>Marketing</option>
                                <option value="Tools" ${expense.category === 'Tools' ? 'selected' : ''}>Tools & Software</option>
                                <option value="Salaries" ${expense.category === 'Salaries' ? 'selected' : ''}>Salaries</option>
                                <option value="Office" ${expense.category === 'Office' ? 'selected' : ''}>Office Expenses</option>
                                <option value="Travel" ${expense.category === 'Travel' ? 'selected' : ''}>Travel</option>
                                <option value="Utilities" ${expense.category === 'Utilities' ? 'selected' : ''}>Utilities</option>
                                <option value="Other" ${expense.category === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editExpenseDate">Expense Date *</label>
                            <input type="date" id="editExpenseDate" value="${expense.date}" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editExpenseDescription">Description</label>
                        <textarea id="editExpenseDescription" rows="3">${expense.description || ''}</textarea>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Expense
                        </button>
                        <button type="button" class="btn btn-danger" onclick="closeEditModal()" style="margin-left: 1rem;">
                            Cancel
                        </button>
                    </div>
                </form>
            `;

            showEditModal('Edit Expense', modalContent);

            document.getElementById('editExpenseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const updatedExpense = {
                    ...expense,
                    title: document.getElementById('editExpenseTitle').value,
                    amount: parseFloat(document.getElementById('editExpenseAmount').value),
                    category: document.getElementById('editExpenseCategory').value,
                    date: document.getElementById('editExpenseDate').value,
                    description: document.getElementById('editExpenseDescription').value
                };

                const index = appData.expenses.findIndex(e => e.id === id);
                appData.expenses[index] = updatedExpense;

                renderExpensesTable();
                updateDashboard();
                closeEditModal();
                showNotification('Expense updated successfully!', 'success');
            });
        }

        function showEditModal(title, content) {
            document.getElementById('editModalTitle').textContent = title;
            document.getElementById('editModalContent').innerHTML = content;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function filterTable(tableType) {
            const searchTerm = document.getElementById(tableType + 'Search').value.toLowerCase();
            const tbody = document.getElementById(tableType + 'TableBody');
            const rows = tbody.getElementsByTagName('tr');

            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function sortTable(tableType, columnIndex) {
            const tbody = document.getElementById(tableType + 'TableBody');
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            
            rows.sort((a, b) => {
                const aText = a.cells[columnIndex].textContent.trim();
                const bText = b.cells[columnIndex].textContent.trim();
                
                // Check if it's a number (for amount columns)
                const aNum = parseFloat(aText.replace(/[^\d.-]/g, ''));
                const bNum = parseFloat(bText.replace(/[^\d.-]/g, ''));
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return aNum - bNum;
                }
                
                return aText.localeCompare(bText);
            });

            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            let bgColor = '#2ecc71'; // success
            if (type === 'error') bgColor = '#e74c3c';
            if (type === 'info') bgColor = '#3498db';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 2rem;
                background: ${bgColor};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 3000;
                font-weight: 500;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;

            // Add slide-in animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notification);

            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                    if (document.head.contains(style)) {
                        document.head.removeChild(style);
                    }
                }, 300);
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>